<%= title @video.title, link: @video.player_url, target: '_blank' %>

<div id="video_sidebar" class="<%= 'sidebar_noembed' unless @video.access_control['embed'] == 'allowed' %>">
  <table>
    <tbody>
    <tr>
      <td class="desc"><%= t 'player.meta.channel' %></td>
      <td><%= channel_link @profile %></td>
    </tr>
    <tr>
      <td class="desc"><%= t 'player.meta.date' %></td>
      <td><%= l @video.uploaded_at, format: :short %></td>
    </tr>
    <tr>
      <td class="desc"><%= t 'player.meta.duration' %></td>
      <td><%= video_duration @video %></td>
    </tr>
    <% i = 0; @video.categories.each do |category| %>
        <tr>
          <td class="desc"><%= i += 1; t 'player.meta.category' if i == 1 %></td>
          <td><%= category.label %></td>
        </tr>
    <% end %>
    <tr>
      <td class="desc"><%= t 'player.meta.views' %></td>
      <td><%= number_with_delimiter @video.view_count %></td>
    </tr>
    <% if @video.access_control['rate'] == 'allowed' && @video.rating %>
        <tr>
          <td class="desc"><%= t 'player.meta.likes' %></td>
          <td><%= number_with_delimiter @video.rating.likes %></td>
        </tr>
        <tr>
          <td class="desc"><%= t 'player.meta.dislikes' %></td>
          <td><%= number_with_delimiter @video.rating.dislikes %></td>
        </tr>
    <% end %>
    <% if @video.access_control['comment'] == 'allowed' %>
        <tr>
          <td class="desc"><%= t 'player.meta.comments' %></td>
          <td><%= number_with_delimiter @video.comment_count %></td>
        </tr>
    <% end %>
    </tbody>
  </table>
  <p id="download"><%= link_to image_tag("download.gif"), video_download_url(@video.unique_id) %>
    <%= link_to t('player.download.download'), video_download_url(@video.unique_id) %></p>
  <div class="clear"></div>
  <p id="favorite"><% if @saved_video.favorite.nil? %>
    <%= link_to "", void, class: :no_favorite, 'data-url' => log_set_favorite_path(@saved_video) %>
    <%= link_to t("player.favorite"), void, 'data-text' => t("player.no_favorite") %>
    <% else %>
    <%= link_to "", void, class: :favorite, method: :delete, 'data-url' => log_set_favorite_path(@saved_video) %>
    <%= link_to t("player.no_favorite"), void, 'data-text' => t("player.favorite") %>
    <% end %></p>
</div>

<% if @video.access_control['embed'] == 'allowed' then %>
    <%= player %>
<% else %>
    <div class="noembed">
      <%= thumb = @video.thumbnails[1]; link_to image_tag(thumb.url, width: thumb.width, height: thumb.height), @video.player_url, target: '_blank' %>
      <div>
        <strong>
          <%= t 'player.noembed' %>
        </strong>

        <p>
          <%= t('player.noembed2', link: link_to(t('player.noembed_link'), @video.player_url, target: '_blank')).html_safe %>
        </p>
      </div>
    </div>
<% end %>

<div id="description">
  <h4><%= t("player.description") %></h4>
  <p><%= description.blank? ? "<em>#{t("player.description_empty")}</em>".html_safe : description %></p>
</div>

<% if @video.access_control['comment'] == 'allowed' then %>
<div id="comments">
  <h4><%= t("player.comments") %></h4>
  <div id="write_comment">
    <textarea></textarea>
    <button><%= t("player.post_comment") %></button>
  </div>
  <% @comments.each do |comment| %>
  <div class="comment">
    <em><%= channel_link comment.author.uri %></em>
    <span><%= comment.content %></span>
  </div>
  <% end %>
</div>
<% end %>